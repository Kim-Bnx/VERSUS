{"version":3,"file":"RichTextEditorLinkControl.js","sources":["../../src/RichTextEditorControl/RichTextEditorLinkControl.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport {\n  BoxProps,\n  CompoundStylesApiProps,\n  factory,\n  useProps,\n  Factory,\n  PopoverProps,\n  Popover,\n  TextInput,\n  Button,\n  UnstyledButton,\n  Tooltip,\n  rem,\n  useResolvedStylesApi,\n} from '@mantine/core';\nimport { useInputState, useDisclosure, useWindowEvent } from '@mantine/hooks';\nimport { IconExternalLink, IconLink } from '@tabler/icons-react';\nimport { useRichTextEditorContext } from '../RichTextEditor.context';\nimport { RichTextEditorControlBaseProps, RichTextEditorControlBase } from './RichTextEditorControl';\nimport classes from '../RichTextEditor.module.css';\n\nexport type RichTextEditorLinkControlStylesNames =\n  | 'linkEditor'\n  | 'linkEditorDropdown'\n  | 'linkEditorSave'\n  | 'linkEditorInput'\n  | 'linkEditorExternalControl';\n\nexport interface RichTextEditorLinkControlProps\n  extends BoxProps,\n    Omit<RichTextEditorControlBaseProps, 'classNames' | 'styles' | 'vars'>,\n    CompoundStylesApiProps<RichTextEditorLinkControlFactory> {\n  /** Props passed down to Popover component */\n  popoverProps?: Partial<PopoverProps>;\n\n  /** Determines whether external link control tooltip should be disabled, `false` by default */\n  disableTooltips?: boolean;\n\n  /** Initial state for determining whether the link should be an external, `false` by default */\n  initialExternal?: boolean;\n}\n\nexport type RichTextEditorLinkControlFactory = Factory<{\n  props: RichTextEditorLinkControlProps;\n  ref: HTMLButtonElement;\n  stylesNames: RichTextEditorLinkControlStylesNames;\n  compound: true;\n}>;\n\nconst LinkIcon: RichTextEditorControlBaseProps['icon'] = (props) => (\n  <IconLink stroke={1.5} {...props} />\n);\n\nconst defaultProps: Partial<RichTextEditorLinkControlProps> = {};\n\nexport const RichTextEditorLinkControl = factory<RichTextEditorLinkControlFactory>(\n  (_props, ref) => {\n    const props = useProps('RichTextEditorLinkControl', defaultProps, _props);\n    const {\n      classNames,\n      className,\n      style,\n      styles,\n      vars,\n      icon,\n      popoverProps,\n      disableTooltips,\n      initialExternal,\n      ...others\n    } = props;\n\n    const ctx = useRichTextEditorContext();\n\n    const stylesApiProps = { classNames, styles };\n\n    const [url, setUrl] = useInputState('');\n    const [external, setExternal] = useState(initialExternal);\n    const [opened, { open, close }] = useDisclosure(false);\n\n    const handleOpen = () => {\n      open();\n      const linkData = ctx.editor?.getAttributes('link');\n      setUrl(linkData?.href || '');\n      setExternal(linkData?.target === '_blank');\n    };\n\n    const handleClose = () => {\n      close();\n      setUrl('');\n      setExternal(initialExternal);\n    };\n\n    const setLink = () => {\n      handleClose();\n      url === ''\n        ? ctx.editor?.chain().focus().extendMarkRange('link').unsetLink().run()\n        : ctx.editor\n            ?.chain()\n            .focus()\n            .extendMarkRange('link')\n            .setLink({ href: url, target: external ? '_blank' : null })\n            .run();\n    };\n\n    const handleInputKeydown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        setLink();\n      }\n    };\n\n    useWindowEvent('edit-link', handleOpen, false);\n\n    const { resolvedClassNames, resolvedStyles } =\n      useResolvedStylesApi<RichTextEditorLinkControlFactory>({ classNames, styles, props });\n\n    return (\n      <Popover\n        trapFocus\n        shadow=\"md\"\n        withinPortal\n        opened={opened}\n        onClose={handleClose}\n        offset={-44}\n        zIndex={10000}\n        {...popoverProps}\n      >\n        <Popover.Target>\n          <RichTextEditorControlBase\n            icon={icon || LinkIcon}\n            {...others}\n            aria-label={ctx.labels.linkControlLabel}\n            title={ctx.labels.linkControlLabel}\n            onClick={handleOpen}\n            active={ctx.editor?.isActive('link')}\n            ref={ref}\n            classNames={resolvedClassNames}\n            styles={resolvedStyles}\n            className={className}\n            style={style}\n          />\n        </Popover.Target>\n\n        <Popover.Dropdown {...ctx.getStyles('linkEditorDropdown', stylesApiProps)}>\n          <div {...ctx.getStyles('linkEditor', stylesApiProps)}>\n            <TextInput\n              placeholder={ctx.labels.linkEditorInputPlaceholder}\n              aria-label={ctx.labels.linkEditorInputLabel}\n              type=\"url\"\n              value={url}\n              onChange={setUrl}\n              classNames={{ input: ctx.getStyles('linkEditorInput', stylesApiProps).className }}\n              onKeyDown={handleInputKeydown}\n              rightSection={\n                <Tooltip\n                  label={\n                    external ? ctx.labels.linkEditorExternalLink : ctx.labels.linkEditorInternalLink\n                  }\n                  events={{ hover: true, focus: true, touch: true }}\n                  withinPortal\n                  withArrow\n                  disabled={disableTooltips}\n                  zIndex={10000}\n                >\n                  <UnstyledButton\n                    onClick={() => setExternal((e) => !e)}\n                    data-active={external || undefined}\n                    {...ctx.getStyles('linkEditorExternalControl', stylesApiProps)}\n                  >\n                    <IconExternalLink style={{ width: rem(14), height: rem(14) }} stroke={1.5} />\n                  </UnstyledButton>\n                </Tooltip>\n              }\n            />\n\n            <Button\n              variant=\"default\"\n              onClick={setLink}\n              {...ctx.getStyles('linkEditorSave', stylesApiProps)}\n            >\n              {ctx.labels.linkEditorSave}\n            </Button>\n          </div>\n        </Popover.Dropdown>\n      </Popover>\n    );\n  }\n);\n\nRichTextEditorLinkControl.classes = classes;\nRichTextEditorLinkControl.displayName = '@mantine/tiptap/RichTextEditorLinkControl';\n"],"names":["React","IconLink","factory","useProps","useRichTextEditorContext","useInputState","useState","useDisclosure","useWindowEvent","useResolvedStylesApi","Popover","RichTextEditorControlBase","TextInput","Tooltip","UnstyledButton","IconExternalLink","rem","Button","classes"],"mappings":"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"}